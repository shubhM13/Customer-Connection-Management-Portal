
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Registration</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <link href="../assets/global/css/style.css" rel="stylesheet">
    <link href="../assets/global/css/theme.css" rel="stylesheet">
    <link href="../assets/global/css/ui.css" rel="stylesheet">
    <link href="../assets/admin/md-layout1/material-design/css/material.css" rel="stylesheet">
    <link href="../assets/admin/md-layout1/css/layout.css" rel="stylesheet">
  </head>
  <!-- BEGIN BODY -->
  <body class="color-purple">
          <!-- BEGIN TOPBAR -->
        <div class="topbar">
          <div class="header-left">
          <span style="padding: 1%; font-size:15px;"><b>Usage Management Portal</b></span>
          </div>
          <div class="header-right">
            <ul class="header-menu nav navbar-nav">
              <!-- BEGIN USER DROPDOWN -->
              <li class="dropdown" id="language-header">
                <a href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                <i class="fa fa-table" aria-hidden="true"><span> View Usage</span></i>
                </a>
              </li>
              <!-- END USER DROPDOWN -->
              <!-- BEGIN NOTIFICATION DROPDOWN -->
              <li class="dropdown" id="notifications-header">
                <a href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                <i class="fa fa-plus-circle" aria-hidden="true"><span> Add Usage</span></i>
                </a>
              </li>
              <!-- END NOTIFICATION DROPDOWN -->
              <!-- BEGIN USER DROPDOWN -->
              <li class="dropdown" id="user-header">
                <a href="#" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                <img src="../assets/global/images/avatars/user1.png" alt="user image">
                <span class="username" id="logged-user">Hi, John Doe</span>
                </a>
              </li>
              <!-- END USER DROPDOWN -->
              <!-- CHAT BAR ICON -->
              <li id="quickview-toggle"><a href="login--.html"><i class="fa fa-sign-out" aria-hidden="true"></i></a></li>
            </ul>
          </div>
          <!-- header-right -->
        </div>
        <!-- END TOPBAR -->
        <div class="align-items-center vh-100 vw-100">
            <div class="col-md-6 mx-auto center">
                <h1 class="text-center" style="font-size:4rem;padding-bottom:20px;">Dispur Wireless</h1>
              <div class="panel panel-default no-bd">
                <div class="panel-header bg-dark" style="padding: 3%;">
                  <h2 class="panel-title" style="font-size:20px"><strong>Usage For Subscription</strong></h2>
                </div>
                <div class="panel-body bg-white">
                  <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                      <form method="POST" role="form" class="form-validation" novalidate>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label class="control-label">Customer ID</label>
                              <div class="option-group">
                                <select id="cdd" name="role" class="language" onchange="changeFunc(value);" required>
                                  <option value=0>Select cutomer...</option>
                                </select>
                                <i class="fa fa-user" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label class="control-label">Plan ID</label>
                              <div class="option-group">
                                <select id="pdd" name="role" class="language" required>
                                  <option value=0>Select plan...</option>
                                </select>
                                <i class="fa fa-tag" aria-hidden="true"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label class="control-label">Voice Usage</label>
                              <div class="append-icon">
                                <input type="number" name="voice" class="form-control" placeholder='in sec' required>
                                <i class="fa fa-phone" aria-hidden="true"></i>
                              </div>
                            </div>
                           </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                              <label class="control-label">Data Usage</label>
                              <div class="append-icon">
                                <input type="number" name="data" class="form-control" placeholder='in kb' required>
                                <i class="icon-globe"></i>
                              </div>
                            </div>
                           </div>
                        </div>
                        <div class="text-center  m-t-20">
                          <button type="submit" class="btn btn-embossed btn-primary" style="background-color:#7289da!important">Add Usage</button>
                          <button type="reset" class="cancel btn btn-embossed btn-default m-b-10 m-r-0">Cancel</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">
          Copyright &copy; <a href="https://github.com/tango97" style="text-decoration:none"><i class="fa fa-github"></i> tango97</a>
        </p>
      </div>
      <!-- /.container -->
    </footer>
    <a href="#" class="scrollup"><i class="fa fa-angle-up"></i></a> 
    <script src="../assets/global/plugins/jquery/jquery-3.1.0.min.js"></script>
    <script src="../assets/global/plugins/jquery/jquery-migrate-3.0.0.min.js"></script>
    <script src="../assets/global/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/global/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/global/plugins/appear/jquery.appear.js"></script>
    <script src="../assets/global/plugins/jquery-cookies/jquery.cookies.min.js"></script> <!-- Jquery Cookies, for theme -->
    <script src="../assets/global/plugins/jquery-block-ui/jquery.blockUI.min.js"></script> <!-- simulate synchronous behavior when using AJAX -->
    <script src="../assets/global/plugins/bootbox/bootbox.min.js"></script> <!-- Modal with Validation -->
    <script src="../assets/global/plugins/mcustom-scrollbar/jquery.mCustomScrollbar.concat.min.js"></script> <!-- Custom Scrollbar sidebar -->
    <script src="../assets/global/plugins/bootstrap-dropdown/bootstrap-hover-dropdown.min.js"></script> <!-- Show Dropdown on Mouseover -->
    <script src="../assets/global/plugins/select2/dist/js/select2.full.min.js"></script> <!-- Select Inputs -->
    <script src="../assets/global/plugins/icheck/icheck.min.js"></script> <!-- Checkbox & Radio Inputs -->
    <script src="../assets/global/plugins/backstretch/backstretch.min.js"></script> <!-- Background Image -->
    <script src="../assets/global/plugins/bootstrap-progressbar/bootstrap-progressbar.min.js"></script> <!-- Animated Progress Bar -->
    <script src="../assets/global/plugins/charts-chartjs/Chart.min.js"></script>
    <script src="../assets/global/js/builder.js"></script> <!-- Theme Builder -->
    <script src="../assets/global/js/sidebar_hover.js"></script> <!-- Sidebar on Hover -->
    <script src="../assets/global/js/widgets/notes.js"></script> <!-- Notes Widget -->
    <script src="../assets/global/js/quickview.js"></script> <!-- Chat Script -->
    <script src="../assets/global/js/pages/search.js"></script> <!-- Search Script -->
    <!-- BEGIN PAGE SCRIPTS -->
    <script src="../assets/global/plugins/jquery-validation/jquery.validate.js"></script> <!-- Form Validation -->
    <script src="../assets/global/plugins/jquery-validation/additional-methods.min.js"></script> <!-- Form Validation Additional Methods - OPTIONAL -->
    <!-- END  PAGE SCRIPTS -->
    <script src="../assets/admin/md-layout1/material-design/js/material.js"></script>
    <script src="../assets/admin/layout1/js/layout.js"></script>
    <script>
      //$.material.init();
    $(document).ready(function() {
        uid = sessionStorage.getItem('id');
        document.getElementById('logged-user').innerHTML = 'Hi, '+uid
        $.ajax({  
                type: "GET", url: "http://127.0.0.1:5000/customers", dataType: "json", contentType: "application/json", success: function (res)  
                {  
                    $.each(res.message, function (data, value) {  
                        $("#cdd").append($("<option></option>").val(value.customerID).html(value.customerID));  
                    })  
                }  
  
            });   
    // Validation
    if($('.form-validation').length && $.fn.validate){
        /* We add an addition rule to show you. Example : 4 + 8. You can other rules if you want */
        $.validator.methods.operation = function(value, element, param) {
            return value == param;
        };
        $.validator.methods.customemail = function(value, element) {
            return /^([-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4})+$/.test(value);
        };
        $('.form-validation').each(function(){
            var formValidation = $(this).validate({
                success: "valid",
                submitHandler: function() {
                                          event.preventDefault();
                                          // get the form data
                                          // there are many ways to get this data using jQuery (you can use the class or id also)
                                          callUsage = $('input[name=voice').val();
                                          dataUsage = $('input[name=data').val();
                                          cid = document.getElementById("cdd").value;
                                          pid= document.getElementById("pdd").value;
                                          if(pid === null || cid === null || pid === '' || cid === ''){
                                              alert('Insufficient Info');
                                              window.location.reload();
                                          }
                                          sid = cid.toString()+pid.toString();
                                          var formData = {
                                              'sid'               : sid,
                                              'voice'             : callUsage,
                                              'data'              :dataUsage
                                          };
                                          //jQuery Post Method -- quick alt. to ajax
                                          $.post('http://127.0.0.1:5000/usage', formData)
                                          .done(function(result, status, xhr) {                          //done promise callback
                                              //success code
                                              if(result.message){
                                                alert(result.message);
                                                window.location.reload(); 
                                              }            
                                          })
                                          .fail(function(result, status, xhr) {
                                              //error code
                                              alert("Error!");
                                              location.reload();
                                          });    
                },
                errorClass: "form-error",
                validClass: "form-success",
                errorElement: "div",
                ignore: [],
                rules: {       
                    avatar: {extension:"jpg|png|gif|jpeg|doc|docx|pdf|xls|rar|zip"},
                    password2: {equalTo: '#password'},
                    calcul: {operation: 12},
                    url: {url: true},
                    email: {
                        required:  {
                                depends:function(){
                                    $(this).val($.trim($(this).val()));
                                    return true;
                                }   
                            },
                        customemail: true
                    },
                },
                messages:{
                    name: {required: 'Enter your name'},
                    lastname: {required: 'Enter your last name'},
                    firstname: {required: 'Enter your first name'},
                    email: {required: 'Enter email address', customemail: 'Enter a valid email address'},
                    language: {required: 'Enter your language'},
                    mobile: {required: 'Enter your phone number'},
                    avatar: {required: 'You must upload your avatar'},
                    password: {required: 'Write your password'},
                    password2: {required: 'Write your password',equalTo: '2 passwords must be the same'},
                    calcul: {required: 'Enter the result of 4 + 8',operation: 'Result is false. Try again!'},
                    terms: {required: 'You must agree with terms'},

                },
                highlight: function(element, errorClass, validClass) {
                    $(element).closest('.form-control').addClass(errorClass).removeClass(validClass);
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).closest('.form-control').removeClass(errorClass).addClass(validClass);
                },
                errorPlacement: function(error, element) {
                   if (element.hasClass("custom-file") || element.hasClass("checkbox-type") || element.hasClass("language")) {
                        element.closest('.option-group').after(error);
                   }
                   else if (element.is(":radio") || element.is(":checkbox"))  {
                        element.closest('.option-group').after(error);
                   }
                   else if (element.parent().hasClass('input-group'))  {
                        element.parent().after(error);
                   }
                   else{
                       error.insertAfter(element);
                   }
                },
                invalidHandler: function(event, validator) {
                    var errors = validator.numberOfInvalids();         
                }      
            });
            $(".form-validation .cancel").click(function() {
                formValidation.resetForm();
            });
        });
    }               
});
   function changeFunc(cid) {
        var select = document.getElementById("pdd");
        var length = select.options.length;
        for (i = length-1; i >= 0; i--) {
        select.options[i] = null;
        }
            $.ajax({  
            type: "GET", url: "http://127.0.0.1:5000/getSubscriptionList/"+cid, dataType: "json", contentType: "application/json", success: function (res)  
            {  
                $.each(res.subscriptions, function (data, value) {  
                    $("#pdd").append($("<option></option>").val(value.planID).html(value.planID));  
                })  
            }  
  
        }); 
   }
</script>
</body>
</html>
<style>
.vh-100 {
    height: 100vh!important;
}
.vw-100 {
    width: 100vw!important;
}
.align-items-center {
    -ms-flex-align: center!important;
    align-items: center!important;
}
.row {
    display: -ms-flexbox;
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    margin-right: -15px;
    margin-left: -15px;
}
.ml-auto, .mx-auto {
    margin-left: auto!important;
}
.mr-auto, .mx-auto {
    margin-right: auto!important;
}

.center {
    top:15% !important;
    left: 25%! important;
}
</style>